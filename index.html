<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Our Blood Moon</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: black;
      overflow: hidden;
      color: white;
      font-family: 'Georgia', serif;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
    }

    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(20, 20, 20, 0.95);
      padding: 20px 30px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(255,255,255,0.5);
      font-size: 1.2rem;
      text-align: center;
      max-width: 400px;
      display: none;
      z-index: 10;
    }

    .popup button {
      margin-top: 15px;
      background: #ff4d4d;
      border: none;
      padding: 10px 20px;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
    }

    .counter {
      position: absolute;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1rem;
      opacity: 0.85;
    }
  </style>
</head>
<body>
  <canvas id="sky"></canvas>
  <div class="popup" id="popup">
    <p id="popupMessage"></p>
    <button onclick="closePopup()">Close</button>
  </div>
  <div class="counter" id="counter"></div>

  <script>
    const canvas = document.getElementById('sky');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // Messages
    const messages = [
      "Our love began under a bloodmoon, and it keeps glowing brighter",
      "You make the night sky jealous with how much you shine",
      "One month feels like forever in the best way",
      "Your smile is my favorite kind of starlight",
      "I fall for you again every single day",
      "With you, even silence feels like music",
      "Since September 7th, my world has been nothing but wonder"
    ];

    // Shuffle
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    const shuffledMessages = shuffle([...messages]);

    // Stars: static, drawn once
    const stars = [];
    for (let i = 0; i < shuffledMessages.length; i++) {
      stars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        radius: Math.random() * 3 + 2,
        message: shuffledMessages[i]
      });
    }

    function drawStars() {
      ctx.fillStyle = "white";
      for (let star of stars) {
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    // Moon
    let moonX = -150;
    let moonY = canvas.height / 3;
    const moonRadius = 120;
    const moonSpeed = 0.3;
    let glowPulse = 0;

    function drawMoon() {
      glowPulse += 0.05;
      let pulse = Math.sin(glowPulse) * 20 + 40;

      const gradient = ctx.createRadialGradient(moonX, moonY, 10, moonX, moonY, moonRadius);
      gradient.addColorStop(0, "#ff4d4d");
      gradient.addColorStop(1, "#330000");

      ctx.beginPath();
      ctx.arc(moonX, moonY, moonRadius, 0, Math.PI * 2);
      ctx.fillStyle = gradient;
      ctx.shadowColor = "red";
      ctx.shadowBlur = pulse;
      ctx.fill();
      ctx.closePath();

      moonX += moonSpeed;
      if (moonX - moonRadius > canvas.width) {
        moonX = -moonRadius;
      }
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawStars();   // always in the same place
      drawMoon();    // only the moon moves
      requestAnimationFrame(animate);
    }
    animate();

    // Click stars
    canvas.addEventListener("click", (e) => {
      const clickX = e.clientX;
      const clickY = e.clientY;
      for (let star of stars) {
        const dx = clickX - star.x;
        const dy = clickY - star.y;
        if (Math.sqrt(dx*dx + dy*dy) < star.radius + 6) {
          showPopup(star.message);
          break;
        }
      }
    });

    function showPopup(message) {
      document.getElementById("popupMessage").textContent = message;
      document.getElementById("popup").style.display = "block";
    }
    function closePopup() {
      document.getElementById("popup").style.display = "none";
    }

    // Counter
    function updateCounter() {
      const startDate = new Date("2025-09-07");
      const today = new Date();
      const diffTime = Math.abs(today - startDate);
      const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
      document.getElementById("counter").textContent = 
        `🌙 Since 7th September 2025: ${diffDays} days together ❤️`;
    }
    updateCounter();

    // IMPORTANT: keep stars fixed when resizing
    window.addEventListener("resize", () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      drawStars(); // redraw static stars in the SAME places
    });
  </script>
</body>
</html>
