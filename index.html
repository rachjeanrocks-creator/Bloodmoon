<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Our Blood Moon</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: black;
      overflow: hidden;
      color: white;
      font-family: 'Georgia', serif;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
    }

    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(20, 20, 20, 0.95);
      padding: 20px 30px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(255,255,255,0.5);
      font-size: 1.2rem;
      text-align: center;
      max-width: 400px;
      display: none;
      z-index: 10;
    }

    .popup button {
      margin-top: 15px;
      background: #ff4d4d;
      border: none;
      padding: 10px 20px;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
    }

    .counter {
      position: absolute;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1rem;
      opacity: 0.85;
    }
  </style>
</head>
<body>
  <!-- Two canvases: one for static stars, one for glowing moon -->
  <canvas id="stars"></canvas>
  <canvas id="moon"></canvas>

  <div class="popup" id="popup">
    <p id="popupMessage"></p>
    <button onclick="closePopup()">Close</button>
  </div>
  <div class="counter" id="counter"></div>

  <script>
    const starCanvas = document.getElementById('stars');
    const starCtx = starCanvas.getContext('2d');
    const moonCanvas = document.getElementById('moon');
    const moonCtx = moonCanvas.getContext('2d');

    starCanvas.width = moonCanvas.width = window.innerWidth;
    starCanvas.height = moonCanvas.height = window.innerHeight;

    // Messages
    const messages = [
      "Our love began under a bloodmoon, and it keeps glowing brighter",
      "You make the night sky jealous with how much you shine",
      "One month feels like forever in the best way",
      "Your smile is my favorite kind of starlight",
      "I fall for you again every single day",
      "With you, even silence feels like music",
      "Since September 7th, my world has been nothing but wonder"
    ];

    // Shuffle
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    const shuffledMessages = shuffle([...messages]);

    // Generate stars ONCE
    const stars = [];
    for (let i = 0; i < shuffledMessages.length; i++) {
      stars.push({
        x: Math.random() * starCanvas.width,
        y: Math.random() * starCanvas.height,
        radius: Math.random() * 3 + 2,
        message: shuffledMessages[i]
      });
    }

    // Draw stars one time only
    function drawStars() {
      starCtx.fillStyle = "white";
      for (let star of stars) {
        starCtx.beginPath();
        starCtx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
        starCtx.fill();
      }
    }
    drawStars(); // draw once and done ✅

    // Moon animation (glowing only, no movement)
    const moonX = moonCanvas.width / 2;
    const moonY = moonCanvas.height / 3;
    const moonRadius = 120;
    let glowPulse = 0;

    function drawMoon() {
      moonCtx.clearRect(0, 0, moonCanvas.width, moonCanvas.height);

      glowPulse += 0.05;
      let pulse = Math.sin(glowPulse) * 20 + 40;

      const gradient = moonCtx.createRadialGradient(moonX, moonY, 10, moonX, moonY, moonRadius);
      gradient.addColorStop(0, "#ff4d4d");
      gradient.addColorStop(1, "#330000");

      moonCtx.beginPath();
      moonCtx.arc(moonX, moonY, moonRadius, 0, Math.PI * 2);
      moonCtx.fillStyle = gradient;
      moonCtx.shadowColor = "red";
      moonCtx.shadowBlur = pulse;
      moonCtx.fill();
      moonCtx.closePath();

      requestAnimationFrame(drawMoon);
    }
    drawMoon();

    // Click stars
    starCanvas.addEventListener("click", (e) => {
      const clickX = e.clientX;
      const clickY = e.clientY;
      for (let star of stars) {
        const dx = clickX - star.x;
        const dy = clickY - star.y;
        if (Math.sqrt(dx*dx + dy*dy) < star.radius + 6) {
          showPopup(star.message);
          break;
        }
      }
    });

    function showPopup(message) {
      document.getElementById("popupMessage").textContent = message;
      document.getElementById("popup").style.display = "block";
    }
    function closePopup() {
      document.getElementById("popup").style.display = "none";
    }

    // Counter
    function updateCounter() {
      const startDate = new Date("2025-09-07");
      const today = new Date();
      const diffTime = Math.abs(today - startDate);
      const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
      document.getElementById("counter").textContent = 
        `🌙 Since 7th September 2025: ${diffDays} days together ❤️`;
    }
    updateCounter();

    // Resize handling: redraw stars but keep moon centered
    window.addEventListener("resize", () => {
      starCanvas.width = moonCanvas.width = window.innerWidth;
      starCanvas.height = moonCanvas.height = window.innerHeight;
      drawStars();
    });
  </script>
</body>
</html>
